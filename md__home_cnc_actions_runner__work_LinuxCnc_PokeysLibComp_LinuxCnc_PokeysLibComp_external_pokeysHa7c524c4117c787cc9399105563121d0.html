<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LinuxCNC PoKeysLib-Comp: LinuxCNC Integration Testing Plan</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">LinuxCNC PoKeysLib-Comp
   </div>
   <div id="projectbrief">unofficial PoKeys HAL-Component for LinuxCNC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__home_cnc_actions_runner__work_LinuxCnc_PokeysLibComp_LinuxCnc_PokeysLibComp_external_pokeysHa7c524c4117c787cc9399105563121d0.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LinuxCNC Integration Testing Plan </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><b>Date:</b> 2025-07-29 (Created for next session) <b>Status:</b> üìã PLANNED <b>Priority:</b> High <b>Type:</b> Integration Testing</p>
<h1><a class="anchor" id="autotoc_md425"></a>
Objective</h1>
<p >Test the completed RT component with actual LinuxCNC installation and physical PoKeys device to validate real-world functionality.</p>
<h1><a class="anchor" id="autotoc_md426"></a>
Prerequisites Completed ‚úÖ</h1>
<ul>
<li>RT component compiles successfully</li>
<li>All dependencies resolved (PK57i_Disconnect fixed)</li>
<li>Connection monitoring and retry logic restored</li>
<li>HAL pins properly defined</li>
<li>Build system working (both userspace and RT)</li>
</ul>
<h1><a class="anchor" id="autotoc_md427"></a>
Test Environment Setup</h1>
<h2><a class="anchor" id="autotoc_md428"></a>
Required Hardware</h2>
<ul>
<li>[ ] PoKeys device (USB or Ethernet)</li>
<li>[ ] Test machine with LinuxCNC installed</li>
<li>[ ] Basic I/O components for testing (LEDs, switches, etc.)</li>
</ul>
<h2><a class="anchor" id="autotoc_md429"></a>
LinuxCNC Configuration</h2>
<ul>
<li>[ ] Create test HAL configuration file</li>
<li>[ ] Load pokeys_async RT component</li>
<li>[ ] Verify HAL pins are available</li>
<li>[ ] Test basic pin connectivity</li>
</ul>
<h1><a class="anchor" id="autotoc_md430"></a>
Testing Phases</h1>
<h2><a class="anchor" id="autotoc_md431"></a>
Phase 1: Component Loading ‚è≥</h2>
<div class="fragment"><div class="line"># Test RT component loading</div>
<div class="line">halrun</div>
<div class="line">loadrt threads name1=test-thread period1=1000000</div>
<div class="line">loadrt pokeys_async</div>
<div class="line">show funct</div>
<div class="line">show pin</div>
<div class="line">show param</div>
<div class="line">addf pokeys-async.0 test-thread</div>
<div class="line">start</div>
</div><!-- fragment --><p ><b>Expected Results:</b></p><ul>
<li>Component loads without errors</li>
<li>HAL pins visible</li>
<li>Functions available for thread assignment</li>
</ul>
<h2><a class="anchor" id="autotoc_md432"></a>
Phase 2: Device Communication ‚è≥</h2>
<ul>
<li>[ ] Test device discovery and connection</li>
<li>[ ] Validate async communication</li>
<li>[ ] Test connection monitoring features</li>
<li>[ ] Verify retry logic under failure conditions</li>
</ul>
<h2><a class="anchor" id="autotoc_md433"></a>
Phase 3: HAL Pin Functionality ‚è≥</h2>
<ul>
<li>[ ] Test digital input pins</li>
<li>[ ] Test digital output pins</li>
<li>[ ] Test analog input pins</li>
<li>[ ] Test encoder pins</li>
<li>[ ] Verify pin state updates</li>
</ul>
<h2><a class="anchor" id="autotoc_md434"></a>
Phase 4: Performance Validation ‚è≥</h2>
<ul>
<li>[ ] Measure RT performance characteristics</li>
<li>[ ] Test under various load conditions</li>
<li>[ ] Validate timing requirements</li>
<li>[ ] Check for RT violations</li>
</ul>
<h1><a class="anchor" id="autotoc_md435"></a>
Key Features to Validate</h1>
<h2><a class="anchor" id="autotoc_md436"></a>
Connection Monitoring (NEW - Fixed Today)</h2>
<div class="fragment"><div class="line"><span class="comment">// Test new connection quality features</span></div>
<div class="line"><a class="code hl_function" href="PoKeysLibAsync_8h.html#a322fde4aaa047557a000cceee6f2746c">PK_DeviceConnectionQualityAsync</a>(device, &amp;quality);</div>
<div class="line"><a class="code hl_function" href="PoKeysLibAsync_8h.html#a9ac58fa48bde079a2a8f8f3c350f33b6">PK_DeviceConnectionFailureAsync</a>(device); <span class="comment">// Failure handling</span></div>
<div class="ttc" id="aPoKeysLibAsync_8h_html_a322fde4aaa047557a000cceee6f2746c"><div class="ttname"><a href="PoKeysLibAsync_8h.html#a322fde4aaa047557a000cceee6f2746c">PK_DeviceConnectionQualityAsync</a></div><div class="ttdeci">int PK_DeviceConnectionQualityAsync(sPoKeysDevice *device, uint8_t *quality)</div><div class="ttdoc">Check connection quality metrics (async)</div><div class="ttdef"><b>Definition:</b> <a href="PoKeysLibDeviceStatusAsync_8c_source.html#l00199">PoKeysLibDeviceStatusAsync.c:199</a></div></div>
<div class="ttc" id="aPoKeysLibAsync_8h_html_a9ac58fa48bde079a2a8f8f3c350f33b6"><div class="ttname"><a href="PoKeysLibAsync_8h.html#a9ac58fa48bde079a2a8f8f3c350f33b6">PK_DeviceConnectionFailureAsync</a></div><div class="ttdeci">int PK_DeviceConnectionFailureAsync(sPoKeysDevice *device)</div><div class="ttdoc">Handle communication failure (for retry logic)</div><div class="ttdef"><b>Definition:</b> <a href="PoKeysLibDeviceStatusAsync_8c_source.html#l00241">PoKeysLibDeviceStatusAsync.c:241</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md437"></a>
Device Status Monitoring (NEW - Fixed Today)</h2>
<ul>
<li>CPU load monitoring</li>
<li>USB/Network load tracking</li>
<li>Temperature monitoring</li>
<li>Buffer utilization</li>
<li>Error count tracking</li>
</ul>
<h2><a class="anchor" id="autotoc_md438"></a>
Retry Logic (NEW - Fixed Today)</h2>
<ul>
<li>Consecutive failure counting</li>
<li>Connection quality degradation</li>
<li>Automatic recovery attempts</li>
</ul>
<h1><a class="anchor" id="autotoc_md439"></a>
Success Criteria</h1>
<h2><a class="anchor" id="autotoc_md440"></a>
Functional Requirements</h2>
<ul>
<li>[x] RT component compiles ‚úÖ</li>
<li>[ ] Component loads in LinuxCNC ‚è≥</li>
<li>[ ] Device connects successfully ‚è≥ <br  />
</li>
<li>[ ] HAL pins respond to device state ‚è≥</li>
<li>[ ] Real-time performance acceptable ‚è≥</li>
</ul>
<h2><a class="anchor" id="autotoc_md441"></a>
Reliability Requirements</h2>
<ul>
<li>[ ] Handles connection loss gracefully ‚è≥</li>
<li>[ ] Recovers from device errors ‚è≥</li>
<li>[ ] Maintains timing under load ‚è≥</li>
<li>[ ] No RT violations detected ‚è≥</li>
</ul>
<h1><a class="anchor" id="autotoc_md442"></a>
Test Scripts and Configurations</h1>
<h2><a class="anchor" id="autotoc_md443"></a>
Basic HAL Test Configuration</h2>
<div class="fragment"><div class="line"># Load the RT component</div>
<div class="line">loadrt pokeys_async</div>
<div class="line"> </div>
<div class="line"># Load threads</div>
<div class="line">loadrt threads name1=servo-thread period1=1000000</div>
<div class="line"> </div>
<div class="line"># Add function to thread</div>
<div class="line">addf pokeys-async.0 servo-thread</div>
<div class="line"> </div>
<div class="line"># Start realtime</div>
<div class="line">start</div>
<div class="line"> </div>
<div class="line"># Test basic functionality</div>
<div class="line">show pin pokeys*</div>
<div class="line">setp pokeys.0.digital-out-00 1</div>
<div class="line">show pin pokeys.0.digital-in-00</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md444"></a>
Connection Test Script</h2>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line"># Test connection reliability</div>
<div class="line">for i in {1..100}; do</div>
<div class="line">    echo &quot;Test iteration $i&quot;</div>
<div class="line">    halcmd setp pokeys.0.test-connection 1</div>
<div class="line">    sleep 0.1</div>
<div class="line">    halcmd show pin pokeys.0.connection-status</div>
<div class="line">done</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md445"></a>
Documentation Tasks</h1>
<ul>
<li>[ ] Document successful test procedures</li>
<li>[ ] Create troubleshooting guide for common issues</li>
<li>[ ] Update HAL pin reference with actual pin names</li>
<li>[ ] Create example configurations for different use cases</li>
</ul>
<h1><a class="anchor" id="autotoc_md446"></a>
Known Limitations &amp; Workarounds</h1>
<ul>
<li>Windows development environment cannot run LinuxCNC tests</li>
<li>Need Linux environment for actual RT testing <br  />
</li>
<li>Physical device required for full validation</li>
<li>Network latency may affect connection quality metrics</li>
</ul>
<h1><a class="anchor" id="autotoc_md447"></a>
Next Steps After Testing</h1>
<ol type="1">
<li><b>If successful:</b> Create user documentation and examples</li>
<li><b>If issues found:</b> Debug and fix remaining problems</li>
<li><b>Performance optimization:</b> Based on test results</li>
<li><b>Extended testing:</b> Multiple devices, complex configurations</li>
</ol>
<hr  />
<p ><b>Preparation for Next Session:</b></p><ol type="1">
<li>Ensure Linux test environment available</li>
<li>Have PoKeys device ready for testing</li>
<li>LinuxCNC properly installed and configured</li>
<li>Review test scripts and modify as needed</li>
</ol>
<p ><b>Files to Reference:</b></p><ul>
<li><code><a class="el" href="pokeys__async_8c.html">experimental/pokeys_async.c</a></code> - RT component implementation</li>
<li><code>experimental/Submakefile.rt</code> - Build configuration <br  />
</li>
<li><code><a class="el" href="RT__Compilation__Header__Organization__Fix_8md.html">docs/tasks/completed/RT_Compilation_Header_Organization_Fix.md</a></code> - Today's fixes</li>
<li>HAL pin definitions in component source </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
