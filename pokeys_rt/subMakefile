# Makefile for compiling HAL realtime modules outside the LinuxCNC source tree

# Compiler
CC = gcc

# Compiler flags
CFLAGS = -Wall -Wextra -fPIC

# Source files
SRCS = pokeys_rt.c PoKeysLibCore.c PoKeysLibCoreSockets.c PoKeysLibDeviceData.c PoKeysLibIO.c PoKeysLibEncoders.c PoKeysLibMatrixLED.c PoKeysLibMatrixKB.c PoKeysLibPoNET.c PoKeysLibLCD.c PoKeysLibRTC.c PoKeysLibEasySensors.c PoKeysLibI2C.c PoKeysLib1Wire.c PoKeysLibSPI.c PoKeysLibPulseEngine_v2.c PoKeysLibUART.c PoKeysLibCAN.c PoKeysLibFailsafe.c PoKeysLibWS2812.c
#SRCS = 

# Header files
HDRS = PoKeysLibRt.h PoKeysLibCore.h PoKeysLibCoreSockets.h hidapi.h # Add all your .h files here


# An example Makefile using Makefile.modinc to build one kernel module from
# several source files would read:
# 
obj-m += pokeys_rt.o
#complex-objs := complex1.o complex2.o complex_main.o
pokeys_rt-objs := PoKeysLibCore.c PoKeysLibCoreSockets.c hid-libusb.c PoKeysLibFastUSB.c PoKeysLibDeviceData.c PoKeysLibIO.c PoKeysLibEncoders.c PoKeysLibMatrixLED.c PoKeysLibMatrixKB.c PoKeysLibPoNET.c PoKeysLibLCD.c PoKeysLibRTC.c PoKeysLibEasySensors.c PoKeysLibI2C.c PoKeysLib1Wire.c PoKeysLibSPI.c PoKeysLibPulseEngine_v2.c PoKeysLibCAN.c PoKeysLibUART.c PoKeysLibWS2812.c

#include ./Makefile.modinc


# Object files
OBJS = $(SRCS:.c=.o)

# Target library
LIB = pokeys_rt.so

# Include Makefile.modinc
include /usr/share/linuxcnc/Makefile.modinc


# Build target
modules: $(OBJS)
	$(CC) -shared -o $(LIB) $(OBJS)

$(LIB): $(OBJS)
	$(CC) -shared -o $@ $^

clean:
	rm -f *.ko *.mod.c *.o *.so

install_local:
	cp $(patsubst %.o,%.ko,$(obj-m)) $(RTLIBDIR)/
	cp $(LIB) $(RTLIBDIR)/

# Compile source files
%.o: %.c $(HDRS)
	$(CC) $(CFLAGS) -c $< -o $@

.PHONY: clean install