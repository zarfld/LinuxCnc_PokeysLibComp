<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LinuxCNC PoKeysLib-Comp: Pulse Engine v2 Commands</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">LinuxCNC PoKeysLib-Comp
   </div>
   <div id="projectbrief">unofficial PoKeys HAL-Component for LinuxCNC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__home_cnc_actions_runner__work_LinuxCnc_PokeysLibComp_LinuxCnc_PokeysLibComp_external_pokeysH80baeae5c06ea7e5c0e6c5487565cf67.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Pulse Engine v2 Commands </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document lists the exported helper functions for operating the motion controller in <b>PoKeysLibPulseEngine_v2.c</b>. Each routine issues a specific subcommand under <code>PK_CMD_PULSE_ENGINE_V2</code>.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Command reference</h1>
<h2><a class="anchor" id="autotoc_md28"></a>
PK_PEv2_StatusGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_STATUS (0x00)</code></li>
<li><b>Request fields</b>: <code>param1</code> acts as a handshake value.</li>
<li><b>Response fields</b>: updates <code><a class="el" href="structsPoKeysPEv2.html">sPoKeysPEv2</a></code> with engine status bits, axis states, current positions and engine info.</li>
</ul>
<h2><a class="anchor" id="autotoc_md29"></a>
PK_PEv2_Status2Get</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_STATUS2 (0x08)</code></li>
<li><b>Request fields</b>: none.</li>
<li><b>Response fields</b>: bytes 8‒10 report numbers of dedicated limit and home inputs.</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
PK_PEv2_PulseEngineSetup</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SETUP (0x01)</code></li>
<li><b>Request payload</b>: bytes 8‒13 contain engine enable flag, charge pump flag, generator type, buffer size, emergency switch polarity and output‑enable mask.</li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
PK_PEv2_AdditionalParametersGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_CONFIGURE_MISC (0x06)</code> with <code>param3=1</code>.</li>
<li><b>Response fields</b>: byte 8 stores the emergency input pin number.</li>
</ul>
<h2><a class="anchor" id="autotoc_md32"></a>
PK_PEv2_AdditionalParametersSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_CONFIGURE_MISC (0x06)</code> with <code>param1=1</code>.</li>
<li><b>Request fields</b>: byte 8 carries the emergency input pin.</li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
PK_PEv2_AxisConfigurationGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_AXIS_CONFIGURATION (0x10)</code></li>
<li><b>Request fields</b>: <code>param1</code> selects the axis (0‑7).</li>
<li><b>Response fields</b>: returns the axis configuration block: limits pins, homing speeds, soft limits, filter settings, step/dir options and more, filling the corresponding members in <code><a class="el" href="structsPoKeysPEv2.html">sPoKeysPEv2</a></code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md34"></a>
PK_PEv2_AxisConfigurationSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_AXIS_CONFIGURATION (0x11)</code></li>
<li><b>Request payload</b>: same layout as the block returned by <code>PK_PEv2_AxisConfigurationGet</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md35"></a>
PK_PEv2_PositionSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_AXIS_POSITION (0x03)</code></li>
<li><b>Request fields</b>: <code>param2</code> is a bit mask of affected axes; bytes 8‒39 contain the new positions for all axes.</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
PK_PEv2_PulseEngineStateSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_STATE (0x02)</code></li>
<li><b>Request fields</b>: param1 is the desired state, param2 controls limit override and param3 holds the axis enable mask.</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
PK_PEv2_PulseEngineMove</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_MOVE (0x20)</code></li>
<li><b>Request payload</b>: reference position or speed for each axis (8×32‑bit values).</li>
</ul>
<h2><a class="anchor" id="autotoc_md38"></a>
PK_PEv2_PulseEngineMovePV</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_MOVE_PV (0x25)</code></li>
<li><b>Request payload</b>: same reference positions plus 16‑bit scaled velocity ratios in bytes 40‒55.</li>
</ul>
<h2><a class="anchor" id="autotoc_md39"></a>
PK_PEv2_ExternalOutputsGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_OUTPUTS (0x04)</code> with <code>param3=1</code>.</li>
<li><b>Response fields</b>: byte 3 holds relay outputs, byte 4 holds open‑collector outputs.</li>
</ul>
<h2><a class="anchor" id="autotoc_md40"></a>
PK_PEv2_ExternalOutputsSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_OUTPUTS (0x04)</code></li>
<li><b>Request fields</b>: param1 is relay outputs and param2 is open‑collector outputs.</li>
</ul>
<h2><a class="anchor" id="autotoc_md41"></a>
PK_PEv2_BufferFill</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_FILL_BUFFER_8BIT (0xFF)</code></li>
<li><b>Request fields</b>: param1 is the number of entries to copy, param2 carries the enable mask; payload bytes 8‒63 contain up to 56 bytes of motion data.</li>
<li><b>Response fields</b>: byte 2 reports the number of accepted entries and the engine status is refreshed.</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
PK_PEv2_BufferFill_16</h2>
<ul>
<li><b>Command ID</b>: <code>0xFE</code> (16‑bit buffer variant)</li>
<li><b>Request/response</b>: identical to <code>PK_PEv2_BufferFill</code> but for 16‑bit motion words.</li>
</ul>
<h2><a class="anchor" id="autotoc_md43"></a>
PK_PEv2_BufferFillLarge</h2>
<ul>
<li><b>Command ID</b>: <code>PK_CMD_MULTIPART_PACKET (0xB0)</code> with subcommand <code>0xFF</code>.</li>
<li><b>Request fields</b>: param2 is entry count, param3 is the enable mask; payload sends 448 bytes of motion buffer using multipart transfer.</li>
</ul>
<h2><a class="anchor" id="autotoc_md44"></a>
PK_PEv2_BufferFillLarge_16</h2>
<ul>
<li><b>Command ID</b>: <code>PK_CMD_MULTIPART_PACKET (0xB0)</code> with subcommand <code>0xFE</code>.</li>
<li><b>Request/response</b>: same as <code>PK_PEv2_BufferFillLarge</code> but for 16‑bit entries.</li>
</ul>
<h2><a class="anchor" id="autotoc_md45"></a>
PK_PEv2_BufferClear</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_CLEAR_BUFFER (0xF0)</code></li>
<li><b>Request fields</b>: none.</li>
</ul>
<h2><a class="anchor" id="autotoc_md46"></a>
PK_PEv2_PulseEngineReboot</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_REBOOT (0x05)</code></li>
<li><b>Request fields</b>: none.</li>
</ul>
<h2><a class="anchor" id="autotoc_md47"></a>
PK_PEv2_HomingStart</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_START_HOMING (0x21)</code></li>
<li><b>Request fields</b>: param1 contains the axis bit mask; bytes 8‒39 hold home offsets for each axis.</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
PK_PEv2_HomingFinish</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_FINISH_HOMING (0x22)</code></li>
<li><b>Request fields</b>: param1 is the new engine state (typically <code>STOPPED</code>), param2 is set to <code>1</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
PK_PEv2_ProbingStart</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_START_PROBING (0x23)</code></li>
<li><b>Request fields</b>: param1 selects axes; bytes 8‒39 contain max probe positions, byte 40 holds probe speed (float), bytes 44‑45 define probe input and polarity.</li>
</ul>
<h2><a class="anchor" id="autotoc_md50"></a>
PK_PEv2_ProbingHybridStart</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_START_PROBING (0x23)</code> with <code>param2=1</code>.</li>
<li><b>Request fields</b>: bytes 44‑45 define probe input and polarity.</li>
</ul>
<h2><a class="anchor" id="autotoc_md51"></a>
PK_PEv2_ProbingFinish</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_FINISH_PROBING (0x24)</code></li>
<li><b>Response fields</b>: bytes 8‒39 return the detected probe position and byte 40 contains probe status bits.</li>
</ul>
<h2><a class="anchor" id="autotoc_md52"></a>
PK_PEv2_ProbingFinishSimple</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_FINISH_PROBING (0x24)</code> with <code>param1=1</code>.</li>
<li><b>Response fields</b>: same as <code>PK_PEv2_ProbingFinish</code> but leaves the engine state untouched.</li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
PK_PEv2_ThreadingPrepareForTrigger</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_PREPARE_TRIGGER (0x30)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md54"></a>
PK_PEv2_ThreadingForceTriggerReady</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_FORCE_TRIGGER_READY (0x31)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md55"></a>
PK_PEv2_ThreadingTrigger</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_ARM_TRIGGER (0x32)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md56"></a>
PK_PEv2_ThreadingRelease</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_RELEASE_TRIGGER (0x33)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md57"></a>
PK_PEv2_ThreadingCancel</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_CANCEL_THREADING (0x34)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md58"></a>
PK_PEv2_ThreadingStatusGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_THREADING_STATUS (0x35)</code></li>
<li><b>Response fields</b>: returns trigger state flags and spindle diagnostics such as speed estimate, position error and debug values.</li>
</ul>
<h2><a class="anchor" id="autotoc_md59"></a>
PK_PEv2_ThreadingSetup</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_THREADING_PARAMS (0x36)</code></li>
<li><b>Request fields</b>: bytes 8, 12‒20 carry sensor mode, ticks per revolution, target RPM and filter gains. Byte 20 holds the ignored‑axis mask.</li>
</ul>
<h2><a class="anchor" id="autotoc_md60"></a>
PK_PEv2_BacklashCompensationSettings_Get</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_BACKLASH_SETTINGS (0x40)</code></li>
<li><b>Response fields</b>: arrays for backlash width, acceleration and current register plus global enable and max speed bytes.</li>
</ul>
<h2><a class="anchor" id="autotoc_md61"></a>
PK_PEv2_BacklashCompensationSettings_Set</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_BACKLASH_SETTINGS (0x41)</code></li>
<li><b>Request fields</b>: same structure as returned by the getter.</li>
</ul>
<h2><a class="anchor" id="autotoc_md62"></a>
PK_PEv2_SyncedPWMSetup</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SETUP_SYNCED_PWM (0x0A)</code></li>
<li><b>Request fields</b>: <code>enabled</code>, source axis and destination PWM channel.</li>
</ul>
<h2><a class="anchor" id="autotoc_md63"></a>
PK_PEv2_SyncOutputsSetup</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SETUP_SYNCED_DIGITAL (0x0B)</code></li>
<li><b>Request fields</b>: axis ID and eight‑byte mapping table.</li>
</ul>
<h2><a class="anchor" id="autotoc_md64"></a>
PK_PoStep_ConfigurationGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SETUP_DRIVER_COMM (0x50)</code></li>
<li><b>Response fields</b>: driver type, I²C address and update flags for each axis plus the global communication enable flag.</li>
</ul>
<h2><a class="anchor" id="autotoc_md65"></a>
PK_PoStep_ConfigurationSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SETUP_DRIVER_COMM (0x50)</code> with <code>param1=0x10</code>.</li>
<li><b>Request payload</b>: same fields as returned by <code>PK_PoStep_ConfigurationGet</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md66"></a>
PK_PoStep_StatusGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_DRIVER_STATUS (0x51)</code></li>
<li><b>Response fields</b>: voltage, temperature and status bytes for each PoStep driver.</li>
</ul>
<h2><a class="anchor" id="autotoc_md67"></a>
PK_PoStep_DriverConfigurationGet</h2>
<ul>
<li><b>Command IDs</b>: <code>PEV2_CMD_DRIVER_CURRENT_PARAMS (0x52)</code> and <code>PEV2_CMD_DRIVER_MODE_PARAMS (0x53)</code></li>
<li><b>Response fields</b>: per‑axis current limits, driver mode, microstep setting and temperature limit.</li>
</ul>
<h2><a class="anchor" id="autotoc_md68"></a>
PK_PoStep_DriverConfigurationSet</h2>
<ul>
<li><b>Command IDs</b>: <code>PEV2_CMD_DRIVER_CURRENT_PARAMS (0x52)</code> and <code>PEV2_CMD_DRIVER_MODE_PARAMS (0x53)</code> with <code>param1=0x10</code>.</li>
<li><b>Request payload</b>: same structure as returned by <code>PK_PoStep_DriverConfigurationGet</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md69"></a>
PK_PEv2_InternalDriversConfigurationGet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_GET_INTERNAL_DRIVERS (0x18)</code></li>
<li><b>Response fields</b>: step mode and current settings for the four internal drivers.</li>
</ul>
<h2><a class="anchor" id="autotoc_md70"></a>
PK_PEv2_InternalDriversConfigurationSet</h2>
<ul>
<li><b>Command ID</b>: <code>PEV2_CMD_SET_INTERNAL_DRIVERS (0x19)</code></li>
<li><b>Request payload</b>: same fields as returned by the getter. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
